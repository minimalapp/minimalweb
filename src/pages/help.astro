---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import PageHero from '@/components/PageHero.astro';
import ContentSection from '@/components/ContentSection.astro';
import SectionTitle from '@/components/SectionTitle.astro';
import CodeBlock from '@/components/CodeBlock.astro';
import FAQ from '@/components/FAQ.astro';
import CTASection from '@/components/CTASection.astro';
import Button from '@/components/Button.astro';
import StepSection from '@/components/StepSection.astro';
import CategoryCard from '@/components/CategoryCard.astro';
import MetricBox from '@/components/MetricBox.astro';
import InfoBox from '@/components/InfoBox.astro';

const locale = 'en';

const gettingStartedSteps = [
  {
    number: 1,
    title: "Create Your Account",
    description: "Sign up at minimal.lat with your email. You'll get access to the dashboard where you can manage all your sites.",
    content: ''
  },
  {
    number: 2,
    title: "Add Your Website",
    description: "Click \"Add New Site\" in your dashboard, enter your website URL, and you'll receive a unique Site ID. This ID connects Minimal to your website.",
    content: ''
  },
  {
    number: 3,
    title: "Install the Script",
    description: "Copy the provided script and paste it before the closing </body> tag on your website. The widget will appear automatically.",
    content: '<div class="bg-[#0F1419] text-[var(--brand-green)] p-6 rounded-lg font-mono text-sm overflow-x-auto"><code>&lt;script src="https://minimal.lat/embed.js" data-site-id="your-site-id"&gt;&lt;/script&gt;</code></div>'
  },
  {
    number: 4,
    title: "Customize & Launch",
    description: "From your dashboard, customize colors, position, greeting messages, and more. Changes apply instantly – no need to update your code!",
    content: ''
  }
];

const faqItems = [
  {
    question: "How do I customize the widget colors?",
    answer: `<p>You can customize colors in two ways:</p>
      <ol>
        <li><strong>Dashboard:</strong> Go to Settings → Appearance and use the color picker to choose your brand colors.</li>
        <li><strong>Code:</strong> Use the <code>customColors</code> option in JavaScript configuration:</li>
      </ol>
      <div class="bg-[#0F1419] text-[var(--brand-green)] p-6 rounded-lg my-4">
        <pre><code>customColors: {
  primary: '#10b981',    // Main accent color
  background: '#ffffff', // Chat background
  text: '#1f2937'       // Text color
}</code></pre>
      </div>`
  },
  {
    question: "Can I hide the widget on specific pages?",
    answer: `<p>Yes! Use the <code>hideOnPages</code> configuration option:</p>
      <div class="bg-[#0F1419] text-[var(--brand-green)] p-6 rounded-lg my-4">
        <code>hideOnPages: ['/checkout', '/payment', '/admin/*']</code>
      </div>
      <p>Supports wildcards for pattern matching. You can also use <code>showOnPages</code> to only display on specific pages.</p>`
  },
  {
    question: "How do I integrate with Google Analytics?",
    answer: `<p>Minimal automatically tracks events that you can capture in Google Analytics:</p>
      <div class="bg-[#0F1419] text-[var(--brand-green)] p-6 rounded-lg my-4">
        <pre><code>window.addEventListener('minimal:message', function(e) {
  gtag('event', 'chat_message_sent', {
    'event_category': 'engagement',
    'event_label': 'Chat Interaction'
  });
});</code></pre>
      </div>
      <p>See our <a href="/integration" class="text-[var(--brand-green)] hover:underline">Integration Guide</a> for more analytics platforms.</p>`
  },
  {
    question: "What happens if I reach my plan limits?",
    answer: `<p>We'll notify you via email when you reach 80% of your plan limits. If you exceed:</p>
      <ul>
        <li><strong>Conversations:</strong> The widget continues working, but you'll need to upgrade to access new conversations in the dashboard.</li>
        <li><strong>Pageviews:</strong> Tracking continues, and you can upgrade anytime to access full analytics.</li>
      </ul>
      <p>Your visitors will never see any interruption in service.</p>`
  }
];
---

<BaseLayout title="Help Center - Minimal" description="Get help and find answers to common questions." locale={locale}>
  <Header locale={locale} />

  <main class="pt-header">
    <PageHero
      title="Help Center"
      subtitle="Get help and find answers to common questions about Minimal."
    >
      <div class="relative max-w-2xl mx-auto mt-8">
        <svg class="absolute left-6 top-1/2 -translate-y-1/2 w-6 h-6 text-[var(--text-tertiary)] pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input type="text" class="w-full px-6 py-4 pl-[100px] text-lg border-2 border-[var(--border-primary)] rounded-full bg-[var(--bg-primary)] text-[var(--text-primary)] placeholder:text-[var(--text-tertiary)] transition-colors focus:outline-none focus:border-[var(--brand-green)]" placeholder="Search documentation..." />
      </div>
    </PageHero>

    <!-- Help Categories -->
    <ContentSection>
      <SectionTitle title="Browse by Category" centered={true} />
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8">
        <CategoryCard
          href="#getting-started"
          icon="rocket"
          title="Getting Started"
          description="Learn the basics and set up Minimal"
        />
        <CategoryCard
          href="#integration"
          icon="puzzle-piece"
          title="Integration Guide"
          description="Platform-specific setup instructions"
        />
        <CategoryCard
          href="#customization"
          icon="paint-brush"
          title="Customization"
          description="Personalize appearance and behavior"
        />
        <CategoryCard
          href="#analytics"
          icon="chart-bar"
          title="Analytics"
          description="Understanding your metrics"
        />
        <CategoryCard
          href="#troubleshooting"
          icon="wrench"
          title="Troubleshooting"
          description="Common issues and solutions"
        />
        <CategoryCard
          href="#api"
          icon="code"
          title="API Reference"
          description="Developer documentation"
        />
      </div>
    </ContentSection>

    <!-- Getting Started -->
    <ContentSection id="getting-started" background="secondary" className="scroll-mt-32">
      <SectionTitle title="Getting Started with Minimal" />
      <StepSection steps={gettingStartedSteps} />
    </ContentSection>

    <!-- Integration Guide -->
    <ContentSection id="integration" className="scroll-mt-32">
      <div class="max-w-4xl mx-auto">
        <SectionTitle title="Integration Guide" centered={true} />
        <p class="text-center text-xl text-[var(--text-secondary)] mb-8 max-w-4xl mx-auto leading-relaxed">Choose your platform and follow the installation instructions. Need help? Check our <a href="/integration" class="text-[var(--brand-green)] hover:underline">detailed integration page</a>.</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <InfoBox
            icon="code"
            title="Web Platforms"
            description="Install Minimal on any website with a simple script tag or use our framework-specific packages."
            items={[
              'HTML/JavaScript - One line script tag',
              'React - npm package with hooks',
              'Vue.js - Plugin for Vue 3',
              'Angular - Native module',
              'Next.js - Optimized for SSR'
            ]}
            variant="tertiary"
          />

          <InfoBox
            icon="shopping-cart"
            title="E-commerce & CMS"
            description="Native integrations for popular platforms with easy dashboard configuration."
            items={[
              'WordPress - Plugin from repository',
              'Shopify - App from app store',
              'WooCommerce - WordPress extension',
              'Webflow - Custom code integration',
              'Squarespace - Code injection'
            ]}
            variant="tertiary"
          />
        </div>
      </div>
    </ContentSection>

    <!-- Advanced Customization -->
    <ContentSection id="customization" background="secondary" className="scroll-mt-32">
      <div class="max-w-4xl mx-auto">
        <SectionTitle title="Advanced Customization" centered={true} />

        <h3 class="text-2xl text-[var(--text-primary)] font-semibold mb-4 mt-6">Configuration Using Attributes</h3>
        <p class="text-lg text-[var(--text-secondary)] leading-relaxed mb-4">You can customize Minimal directly in the script tag using data attributes:</p>

        <CodeBlock code={`<script
  src="https://minimal.lat/embed.js"
  data-site-id="your-site-id"
  data-position="bottom-right"
  data-theme="auto"
  data-language="en"
></script>`} />

        <h3 class="text-2xl text-[var(--text-primary)] font-semibold mb-4 mt-6">Customization Options</h3>
        <div class="bg-[var(--bg-primary)] border border-[var(--border-primary)] rounded-xl p-6 my-4">
          <div class="py-3 border-b border-[var(--border-primary)]">
            <strong class="text-[var(--text-primary)]">Position:</strong> <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">bottom-right</code>, <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">bottom-left</code>, <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">top-right</code>, <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">top-left</code>
          </div>
          <div class="py-3 border-b border-[var(--border-primary)]">
            <strong class="text-[var(--text-primary)]">Theme:</strong> <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">light</code>, <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">dark</code>, <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">auto</code> (follows system preference)
          </div>
          <div class="py-3 border-b border-[var(--border-primary)]">
            <strong class="text-[var(--text-primary)]">Language:</strong> <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">en</code>, <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">es</code>, <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">fr</code>, <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">de</code>, <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">pt</code>, and more
          </div>
          <div class="py-3 border-b border-[var(--border-primary)]">
            <strong class="text-[var(--text-primary)]">Greeting:</strong> Any custom text for the initial message
          </div>
          <div class="py-3">
            <strong class="text-[var(--text-primary)]">Primary Color:</strong> Hex color code (e.g., <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">#10b981</code>)
          </div>
        </div>

        <h3 class="text-2xl text-[var(--text-primary)] font-semibold mb-4 mt-6">Advanced JavaScript Configuration</h3>
        <p class="text-lg text-[var(--text-secondary)] leading-relaxed mb-4">For more control, use JavaScript configuration:</p>

        <CodeBlock code={`window.MinimalConfig = {
  siteId: 'your-site-id',
  position: 'bottom-right',
  theme: 'auto',
  language: 'en',
  greeting: 'Hi there! How can we help?',
  placeholder: 'Type your message...',

  // Advanced options
  autoOpen: false,
  autoOpenDelay: 3000, // milliseconds
  hideOnPages: ['/checkout', '/payment'],
  showOnPages: ['*'], // all pages by default

  // Styling
  customColors: {
    primary: '#10b981',
    background: '#ffffff',
    text: '#1f2937'
  },

  // Behavior
  collectEmail: true,
  requireEmail: false,
  enableFileUploads: true,
  maxFileSize: 10 // MB
};

<script src="https://minimal.lat/embed.js"></script>`} />
      </div>
    </ContentSection>

    <!-- Analytics -->
    <ContentSection id="analytics" background="secondary" className="scroll-mt-32">
      <div class="max-w-5xl mx-auto">
        <SectionTitle title="Understand Your Analytics" centered={true} />

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <InfoBox
            title="Engagement Metrics"
            description="Track how visitors interact with your chat:"
            items={[
              'Widget Views: Number of times the widget was displayed',
              'Open Rate: Percentage of visitors who opened the chat',
              'Messages Sent: Total messages from visitors',
              'Conversations Started: New conversation threads',
              'Average Response Time: How quickly you respond'
            ]}
          />

          <InfoBox
            title="User Insights"
            description="Understand your visitor behavior:"
            items={[
              'Peak Hours: When visitors are most active',
              'Popular Pages: Where conversations start',
              'Device Breakdown: Desktop vs. mobile usage',
              'Geographic Data: Where your visitors come from',
              'Returning Visitors: Track repeat interactions'
            ]}
          />

          <InfoBox
            title="Conversion Tracking"
            description="Measure business impact:"
            items={[
              'Lead Capture Rate: Percentage of chats that collect emails',
              'Qualified Leads: Conversations marked as sales-ready',
              'Goal Completions: Custom conversion events',
              'Revenue Attribution: Sales linked to chat interactions',
              'ROI Metrics: Return on investment calculations'
            ]}
          />
        </div>
      </div>
    </ContentSection>

    <!-- FAQ Section -->
    <ContentSection>
      <SectionTitle title="Frequently Asked Questions" centered={true} />
      <FAQ items={faqItems} />
    </ContentSection>

    <!-- Troubleshooting -->
    <ContentSection id="troubleshooting" background="secondary" className="scroll-mt-32">
      <div class="max-w-4xl mx-auto">
        <SectionTitle title="Troubleshooting" centered={true} />
        <p class="text-center text-xl text-[var(--text-secondary)] mb-8 max-w-4xl mx-auto leading-relaxed">Common issues and how to resolve them.</p>

        <div class="space-y-6">
          <div class="bg-[var(--bg-primary)] border border-[var(--border-primary)] rounded-md p-6">
            <h3 class="text-xl text-[var(--text-primary)] font-semibold mb-3">Widget Not Appearing</h3>
            <p class="text-[var(--text-secondary)] mb-3">If the widget doesn't show up on your site:</p>
            <ul class="list-disc pl-6 space-y-2 text-[var(--text-secondary)]">
              <li>Verify the script is placed before the closing <code class="bg-[var(--bg-tertiary)] text-[var(--brand-green)] px-2 py-1 rounded text-sm">&lt;/body&gt;</code> tag</li>
              <li>Check that your Site ID is correct in the dashboard</li>
              <li>Ensure JavaScript is enabled in your browser</li>
              <li>Clear your browser cache and hard reload (Ctrl+Shift+R or Cmd+Shift+R)</li>
              <li>Check browser console for any error messages</li>
            </ul>
          </div>

          <div class="bg-[var(--bg-primary)] border border-[var(--border-primary)] rounded-md p-6">
            <h3 class="text-xl text-[var(--text-primary)] font-semibold mb-3">Widget Position Issues</h3>
            <p class="text-[var(--text-secondary)] mb-3">If the widget appears in the wrong position or overlaps other elements:</p>
            <ul class="list-disc pl-6 space-y-2 text-[var(--text-secondary)]">
              <li>Adjust the position setting in your dashboard (bottom-right, bottom-left, etc.)</li>
              <li>Check for CSS conflicts with high z-index values on your site</li>
              <li>Use custom CSS to override positioning if needed</li>
              <li>Try different offset values to avoid overlapping with other fixed elements</li>
            </ul>
          </div>

          <div class="bg-[var(--bg-primary)] border border-[var(--border-primary)] rounded-md p-6">
            <h3 class="text-xl text-[var(--text-primary)] font-semibold mb-3">Conversations Not Saving</h3>
            <p class="text-[var(--text-secondary)] mb-3">If conversations aren't appearing in your dashboard:</p>
            <ul class="list-disc pl-6 space-y-2 text-[var(--text-secondary)]">
              <li>Verify you're logged into the correct account</li>
              <li>Check that you're viewing the correct site in the dashboard</li>
              <li>Ensure your plan hasn't reached conversation limits</li>
              <li>Allow a few minutes for data synchronization</li>
              <li>Contact support if the issue persists after 15 minutes</li>
            </ul>
          </div>

          <div class="bg-[var(--bg-primary)] border border-[var(--border-primary)] rounded-md p-6">
            <h3 class="text-xl text-[var(--text-primary)] font-semibold mb-3">Styling Not Applied</h3>
            <p class="text-[var(--text-secondary)] mb-3">If custom colors or styles aren't showing:</p>
            <ul class="list-disc pl-6 space-y-2 text-[var(--text-secondary)]">
              <li>Changes in the dashboard apply instantly - no code updates needed</li>
              <li>Clear browser cache to see latest styling changes</li>
              <li>Check that custom CSS isn't overriding your settings</li>
              <li>Verify color values are in valid hex format (e.g., #10b981)</li>
            </ul>
          </div>
        </div>
      </div>
    </ContentSection>

    <!-- API Reference -->
    <ContentSection id="api" className="scroll-mt-32">
      <div class="max-w-4xl mx-auto">
        <SectionTitle title="API Reference" centered={true} />
        <p class="text-center text-xl text-[var(--text-secondary)] mb-8 max-w-4xl mx-auto leading-relaxed">JavaScript API for advanced control and customization.</p>

        <h3 class="text-2xl text-[var(--text-primary)] font-semibold mb-4">Widget Control Methods</h3>
        <div class="bg-[var(--bg-tertiary)] border border-[var(--border-primary)] rounded-md p-6 mb-6">
          <CodeBlock code={`// Open the widget
Minimal.open();

// Close the widget
Minimal.close();

// Toggle widget state
Minimal.toggle();

// Check if widget is open
const isOpen = Minimal.isOpen(); // returns boolean

// Destroy the widget instance
Minimal.destroy();`} />
        </div>

        <h3 class="text-2xl text-[var(--text-primary)] font-semibold mb-4 mt-8">Event Tracking</h3>
        <div class="bg-[var(--bg-tertiary)] border border-[var(--border-primary)] rounded-md p-6 mb-6">
          <CodeBlock code={`// Track custom events
Minimal.trackEvent('event_name', {
  customData: 'value',
  userId: '12345'
});

// Set user context
Minimal.setContext({
  userId: 'user_123',
  email: 'user@example.com',
  plan: 'premium'
});

// Identify user
Minimal.identify({
  userId: 'user_123',
  name: 'John Doe',
  email: 'john@example.com'
});`} />
        </div>

        <h3 class="text-2xl text-[var(--text-primary)] font-semibold mb-4 mt-8">Event Listeners</h3>
        <div class="bg-[var(--bg-tertiary)] border border-[var(--border-primary)] rounded-md p-6 mb-6">
          <CodeBlock code={`// Listen for widget events
window.addEventListener('minimal:open', () => {
  console.log('Widget opened');
});

window.addEventListener('minimal:close', () => {
  console.log('Widget closed');
});

window.addEventListener('minimal:message', (event) => {
  console.log('Message sent:', event.detail);
});

window.addEventListener('minimal:ready', () => {
  console.log('Widget initialized');
});`} />
        </div>

        <h3 class="text-2xl text-[var(--text-primary)] font-semibold mb-4 mt-8">Configuration Updates</h3>
        <div class="bg-[var(--bg-tertiary)] border border-[var(--border-primary)] rounded-md p-6">
          <CodeBlock code={`// Update configuration at runtime
Minimal.updateConfig({
  theme: 'dark',
  position: 'bottom-left',
  greeting: 'New greeting message'
});

// Get current configuration
const config = Minimal.getConfig();`} />
        </div>
      </div>
    </ContentSection>

    <!-- Need More Help -->
    <CTASection
      title="Need More Help?"
      description="Can't find what you're looking for? Our support team is here to help."
      background="secondary"
    >
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <Button variant="primary" size="lg" href="/contact">
          Contact Support
        </Button>
        <Button variant="secondary" size="lg" href="https://docs.minimal.lat">
          View Full Docs
        </Button>
      </div>
      <p class="text-[var(--text-tertiary)] text-sm mt-6">Average response time: <strong class="text-[var(--text-primary)]">under 2 hours</strong></p>
    </CTASection>
  </main>

  <Footer locale={locale} />
</BaseLayout>
